function draw_graph(e){function g(){var e=my.range.length,t=d3.round(e/2),s=[88,66,44,50,66,88,66,22,22],f=[d3.round(t*.5),t,d3.round(t*1.5),e,d3.round(t*1.75),t,t,t,t,t],h=zoom;if(d3.event){zoom=my.zScale(d3.event.scale);var p=my.zSwitching(zoom);if(p!=my.zSwitching(h)){console.log("changing scales i",p,"zoom",zoom,"old_zoom",h),my.pixel_factor=66,my.pixel_factor=s[p]||66;var d=d3.mouse(this),g=u.invert(d[0]);console.log("mouse is near",g);switch(p){case 0:break;case 1:break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 8:break;default:}}console.log("i",p,"z",zoom,d3.event.scale,d3.event,my,"old",h)}m.selectAll("rect").attr("x",v.x).attr("y",v.y).attr("width",v.width).attr("height",v.height),r.selectAll("circle").attr("cx",function(e,t){return u(e.date)-.5}).attr("cy",function(e){return o-i-a(e.sugar)+.5}),l.scale(u),n.select(".x.axis").call(l),n.select(".y.axis").call(c)}var t,n,r,i=100,s=8,o=500,u,a,f=$("#lab").width(),l,c;zoom=40;var h=[0,200];my.zScale=d3.scale.linear().domain(h).rangeRound([0,1e3]),my.zSwitching=d3.scale.linear().domain([0,1e3]).rangeRound([0,8]),console.log($("#lab"),$("#lab").width()),$("#lab #test").remove(),$("#lab").append($("#clone").clone(!0).attr("id","test")),n=d3.select("#test").append("svg").attr("class","chart").attr("width",f).attr("height",o).append("g"),d3.select("svg g").attr("transform","translate(50, 50)");var p=d3.time.day.round(d3.time.day.offset(new Date,-1)),d=d3.time.day.round(d3.time.day.offset(new Date,1));my.first=p,my.last=d,my.range=d3.time.day.range(d3.time.day.offset(d,-5),d),console.log(my),u=d3.time.scale().domain([my.range[0],d]).range([0,f-i]),a=d3.scale.linear().domain([0,d3.max(e,function(e){return e.sugar})]).rangeRound([0,o-i]),my.x=u,my.y=a;var v={low:70,high:140,x:u.range()[0],y:o-i-a(140)+.5,width:f,height:a(140)-a(70)+.5},m=n.append("g").attr("class","safety");m.append("rect").attr("class","safe-sugar"),r=n.append("g").attr("class","dots"),r.selectAll("circle").data(e).enter().append("circle").attr("r",".5ex"),l=d3.svg.axis().scale(u).ticks(my.range.length).tickSize(12,1,1),c=d3.svg.axis().scale(d3.scale.linear().domain([0,d3.max(e,function(e){return e.sugar||0})]).rangeRound([o-i,0])).ticks(7).tickSize(6,3,1).orient("left"),n.append("g").attr("class","x axis").attr("transform","translate(0, "+(o-i)+")"),n.append("g").attr("class","y axis"),my.zoom=d3.behavior.zoom().x(u).scaleExtent(h).scale(4).on("zoom",g),d3.select("svg").call(my.zoom),g()}function update_data(e){e&&(e.forEach(fix_row),draw_graph(e))}function fix_row(e,t){e.date=d3.time.format.iso.parse(e.date),e.sugar=parseInt(e.sugar)}$(function(){var e="date,sugar\n2011-01-13T15:42:08,108\n2011-01-14T15:42:08,108\n2011-01-15T15:42:08,108\n2011-01-16T15:42:08,108\n2011-01-17T15:42:08,108\n2011-02-15T20:58:25,121\n2011-02-16T20:58:25,121\n2011-02-17T20:58:25,121\n2011-02-18T20:58:25,121\n2011-02-19T20:58:25,121\n2011-02-20T20:58:25,121\n2011-02-21T20:58:25,121\n2011-03-08T16:55:07,100\n2011-03-08T18:29:12,91\n2011-03-08T19:30:37,94\n2011-03-08T21:34:27,126\n2011-03-09T08:38:01,242\n",t=[];t=d3.csv.parse(e),t.forEach(fix_row);var n="../../data/sugars.csv";draw_graph(t),d3.csv(n,update_data)});var my={};